<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>
    Data CLI tool
  </title>
  <meta name="author" content="Datopian">
  <meta name="description" content="Data online made easy. Share and find data, quickly and easily. Simple, solid, slick. Frictionless and fast. Built for data scientists and wranglers. Managed by Datopian and Open Knowledge International">
  <meta name="keywords" content="data,datasets,data publishing,data sharing,data hosting,data package,reference data,indicators">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" type="img/ico" href="../static/img/favicon.ico" sizes="16x16">
  <link rel="stylesheet" media="screen" href="../static/stylesheets/app.css">
  <link href="../static/stylesheets/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="home">
    <!-- Jumbotron main -->
    <div class="container">
      <div class="inner_container">
        <div class="jumbotron jumbotron-primary">
          <div class="row">
            <div class="text-center">
              <img src="../static/img/logo-cube.png" class="img-responsive main-img" alt="">
              <h1 class="main-title">Data online made simple</h1>
            </div>
          </div>
          <div class="text-center">
            <p class="electron-message">
              Checking for the latest updates...
            </p>
            <p id="message"></p>
            <p class="electron-message">
              You can read the tutorial here while we are doing this: <a href="http://datahub.io/docs/getting-started/pushing-data" target="_blank">how to push data.</a>
            </p>
          </div>
        </div>
      </div>
    </div><!-- End of jumbotron main -->

    <script>
      const {ipcRenderer} = require('electron')
      const Nanobar = require('nanobar')
      const updateOnlineStatus = () => {
        ipcRenderer.send('online-status-changed', navigator.onLine ? 'online' : 'offline')
      }

      window.addEventListener('online',  updateOnlineStatus)
      window.addEventListener('offline',  updateOnlineStatus)
      updateOnlineStatus()
      const nanobar = new Nanobar()
      ipcRenderer.on('progress', (event, message) => {
        nanobar.go(message)
        document.getElementById('message').innerText = message + ' %'
      })

      ipcRenderer.on('binaryUpdate', (event, message) => {
        const el = document.getElementsByClassName('electron-message')[0]
        if (message.currentLocal) {
          if (message.currentRemote) { // Will update
            el.innerText += `\nInstalled version is ${message.currentLocal} but we have ${message.currentRemote}`
            el.innerText += 'Please wait, we are updating the CLI tool...'
          } else { // Nothing to update
            el.innerText = `You are using the latest version ${message.currentLocal}!`
          }
        } else { // Will install
          el.innerText = 'Please wait, we are installing the CLI tool on this machine...'
          document.getElementById('message').innerText = '0 %'
        }
      })
    </script>
  </body>
</html>
